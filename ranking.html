
<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üèÜ Ranking - Back to School</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
body{
    font-family:'Prompt',sans-serif;
    background: linear-gradient(135deg,#fdfbfb,#f3e7ff,#e0f2ff);
    overflow-x:hidden;
}

/* Floating BG */
body::before{
    content:"";
    position:fixed;
    width:450px;
    height:450px;
    background: radial-gradient(circle,#d8b4fe,transparent 70%);
    top:-200px;
    left:-200px;
    animation: float1 12s infinite alternate ease-in-out;
    z-index:-1;
}
body::after{
    content:"";
    position:fixed;
    width:400px;
    height:400px;
    background: radial-gradient(circle,#93c5fd,transparent 70%);
    bottom:-200px;
    right:-200px;
    animation: float2 15s infinite alternate ease-in-out;
    z-index:-1;
}

@keyframes float1{
    from{transform:translate(0,0);}
    to{transform:translate(80px,80px);}
}
@keyframes float2{
    from{transform:translate(0,0);}
    to{transform:translate(-100px,-60px);}
}

.card{
    backdrop-filter: blur(14px);
    background: rgba(255,255,255,0.85);
    box-shadow: 0 15px 40px rgba(0,0,0,0.08);
    transition: all .3s ease;
}

@media(min-width:768px){
.card:hover{
    transform: translateY(-6px) scale(1.03);
}
}

.glass{
    backdrop-filter: blur(14px);
    background: rgba(255,255,255,0.85);
}
</style>
</head>

<body class="min-h-screen flex flex-col pb-20 md:pb-0 text-gray-700">

<script>
const judgeName = localStorage.getItem("judge");
if(!judgeName){
  window.location.href="index.html";
}
</script>

<!-- HEADER Desktop -->
<header class="hidden md:flex glass px-6 py-4 justify-between items-center border-b border-white/40 shadow-sm">
  <a href="home.html"
     class="text-xl font-bold text-gray-700 hover:text-purple-600 transition">
    üéì Back to School Voting
  </a>

  <div class="flex items-center gap-3">
    <span class="bg-purple-100 text-purple-700 px-4 py-2 rounded-full text-sm shadow">
      üë§ <span id="judgeNameTab"></span>
    </span>

    <button onclick="logout()"
      class="bg-red-400 hover:bg-red-500 text-white px-4 py-2 rounded-lg text-sm transition shadow">
      Logout
    </button>
  </div>
</header>

<!-- CONTENT -->
<div class="w-full max-w-6xl mx-auto flex-grow px-4 mt-10 md:mt-20">

<div class="text-center mb-10">
  <h1 class="text-2xl md:text-4xl font-bold">
    üèÜ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡πÅ‡∏¢‡∏Å‡∏ù‡πà‡∏≤‡∏¢
  </h1>
  <p class="text-gray-500 mt-2">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏ö‡∏ö Real-Time</p>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

  <!-- üë© ‡∏ù‡πà‡∏≤‡∏¢‡∏´‡∏ç‡∏¥‡∏á -->
  <div class="card rounded-3xl p-6">
    <h2 class="text-xl font-semibold text-pink-500 mb-6 text-center">
      üë© ‡∏ù‡πà‡∏≤‡∏¢‡∏´‡∏ç‡∏¥‡∏á
    </h2>
    <div id="femaleBody" class="space-y-4"></div>
  </div>

  <!-- üë® ‡∏ù‡πà‡∏≤‡∏¢‡∏ä‡∏≤‡∏¢ -->
  <div class="card rounded-3xl p-6">
    <h2 class="text-xl font-semibold text-blue-500 mb-6 text-center">
      üë® ‡∏ù‡πà‡∏≤‡∏¢‡∏ä‡∏≤‡∏¢
    </h2>
    <div id="maleBody" class="space-y-4"></div>
  </div>

</div>
</div>

<!-- üì± MOBILE BOTTOM NAV -->
<nav class="fixed bottom-0 left-0 w-full md:hidden
            glass border-t border-white/40
            flex justify-around items-center
            py-3 text-sm shadow-lg">

<a href="home.html" class="flex flex-col items-center text-gray-600">
  <span>üè†</span>
  <span class="text-xs">Home</span>
</a>

<a href="dashboard.html" class="flex flex-col items-center text-gray-600">
  <span>üìä</span>
  <span class="text-xs">Dashboard</span>
</a>

<a href="ranking.html" class="flex flex-col items-center text-purple-600 font-semibold">
  <span>üèÜ</span>
  <span class="text-xs">Ranking</span>
</a>

<a href="vote.html" class="flex flex-col items-center text-gray-600">
  <span>üìù</span>
  <span class="text-xs">Vote</span>
</a>

</nav>

<footer class="hidden md:block mt-auto w-full text-center py-6 text-sm text-gray-500 bg-white/50 backdrop-blur-md">
  ¬© 2026 Back to School Event | Developed by Jakrayut Sangbunrueang
</footer>

<script>
document.getElementById("judgeNameTab").innerText = judgeName;

function logout(){
  localStorage.removeItem("judge");
  window.location.href="index.html";
}
</script>
<script>

const sheetURL="https://script.google.com/macros/s/AKfycbzy7cnkwb6KowYl7U9d9c36WLXZ70AsN7EOW6rTEfjiGQjGFyoVDCYVx0FCur0ILZ54/exec";




async function loadRanking(){

  const res = await fetch(sheetURL + "?t=" + new Date().getTime());
  const data = await res.json();

  let femaleScores = {};
  let maleScores = {};

  data.forEach(row=>{
    let gender = row.group;
    let num = row.contestant;
    let total = parseInt(row.total) || 0;

    if(gender==="female"){
      if(!femaleScores[num]) femaleScores[num]=0;
      femaleScores[num]+=total;
    }

    if(gender==="male"){
      if(!maleScores[num]) maleScores[num]=0;
      maleScores[num]+=total;
    }
  });

  renderCards(femaleScores,"femaleBody","pink");
  renderCards(maleScores,"maleBody","blue");
}

function renderCards(scores, bodyId, color){

  let genderKey = bodyId === "femaleBody" ? "female" : "male";

  let arr = Object.entries(scores)
  .sort((a,b)=>b[1]-a[1])
  .slice(0,5);

  if(arr.length === 0){
    document.getElementById(bodyId).innerHTML =
    "<div class='text-center text-gray-400'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>";
    return;
  }

  let maxScore = arr[0][1];
  let medals=["üëë","ü•à","ü•â","üèÖ","üèÖ"];
  let html="";

  arr.forEach((item,index)=>{

    let name = item[0];
    let newScore = item[1];
    let oldScore = previousScores[genderKey][name] || 0;

    let percent = Math.round((newScore/maxScore)*100);

    let topStyle="";
    let crownGlow="";

    if(index===0){
      topStyle = `
        scale-105 bg-yellow-100 border-2 border-yellow-400
        shadow-2xl animate-pulse
      `;
      crownGlow = "text-yellow-500 drop-shadow-lg";
    }
    else if(index<3){
      topStyle = `bg-${color}-50 border border-${color}-200`;
    }
    else{
      topStyle = "bg-white";
    }

    html+=`
    <div class="${topStyle} rounded-2xl p-5 shadow transition duration-500">

      <div class="flex justify-between items-center mb-3">

        <div class="text-lg font-semibold flex items-center gap-2">
          <span class="${crownGlow} text-2xl">
            ${medals[index]}
          </span>
          ${name}
        </div>

        <div class="font-bold text-xl text-${color}-600 score-value"
             data-old="${oldScore}"
             data-target="${newScore}">
          ${oldScore} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
        </div>

      </div>

      <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
        <div class="bg-${color}-400 h-3 transition-all duration-700"
             style="width:${percent}%"></div>
      </div>

    </div>`;

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    previousScores[genderKey][name] = newScore;
  });

  document.getElementById(bodyId).innerHTML = html;

  animateScores(bodyId);
}

function animateScores(containerId){

  const scores = document
    .getElementById(containerId)
    .querySelectorAll(".score-value");

  scores.forEach(el=>{

    let oldValue = parseInt(el.dataset.old);
    let target = parseInt(el.dataset.target);

    // ‚ùå ‡∏ñ‡πâ‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πà‡∏á
    if(oldValue === target){
      el.textContent = target + " ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô";
      return;
    }

    let current = oldValue;
    let speed = Math.ceil((target - oldValue) / 30);

    let interval = setInterval(()=>{

      current += speed;

      if(current >= target){
        current = target;
        clearInterval(interval);
      }

      el.textContent = current + " ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô";

    },20);

  });
}
let previousScores = {
  female: {},
  male: {}
};


loadRanking();
setInterval(loadRanking,5000);

</script>

</body>
</html>
