<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vote - Back to School</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
body{
  font-family:'Prompt',sans-serif;
  background: linear-gradient(135deg,#fdfbfb,#f3e7ff,#e0f2ff);
}
.glass{
  backdrop-filter: blur(14px);
  background: rgba(255,255,255,0.8);
  box-shadow: 0 20px 50px rgba(0,0,0,0.08);
}
.active-btn{
  transform:scale(1.08);
  box-shadow:0 0 0 3px rgba(0,0,0,0.1) inset;
}
.fade-in{
  animation:fadeIn 0.6s ease-in-out;
}
@keyframes fadeIn{
  from{opacity:0; transform:translateY(20px);}
  to{opacity:1; transform:translateY(0);}
}
</style>
</head>

<body class="min-h-screen flex flex-col text-gray-700 fade-in pb-24 md:pb-0">

<script>
const judgeName = localStorage.getItem("judge");
if(!judgeName){
  window.location.href="index.html";
}
</script>

<!-- HEADER Desktop -->
<header class="hidden md:flex glass px-6 py-4 justify-between items-center border-b border-white/40 shadow-sm">
  <a href="home.html"
     class="text-xl font-bold text-gray-700 hover:text-purple-600 transition">
    üéì Back to School Voting
  </a>

  <div class="flex items-center gap-3">
    <span class="bg-purple-100 text-purple-700 px-4 py-2 rounded-full text-sm shadow">
      üë§ <span id="judgeNameTab"></span>
    </span>

    <button onclick="logout()"
      class="bg-red-400 hover:bg-red-500 text-white px-4 py-2 rounded-lg text-sm transition shadow">
      Logout
    </button>
  </div>
</header>

<div class="flex-grow">
<div class="max-w-3xl mx-auto p-6">

<h1 class="text-3xl md:text-4xl font-bold text-center mb-10">
üó≥Ô∏è ‡πÇ‡∏´‡∏ß‡∏ï‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô
</h1>

<!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ù‡πà‡∏≤‡∏¢ -->
<div class="flex justify-center gap-6 mb-8 flex-wrap">
  <button id="femaleBtn" onclick="setGroup('female')"
    class="px-8 py-3 rounded-2xl bg-pink-200 text-pink-800 hover:bg-pink-300 font-semibold transition">
    üë© ‡∏ù‡πà‡∏≤‡∏¢‡∏´‡∏ç‡∏¥‡∏á
  </button>

  <button id="maleBtn" onclick="setGroup('male')"
    class="px-8 py-3 rounded-2xl bg-blue-200 text-blue-800 hover:bg-blue-300 font-semibold transition">
    üë® ‡∏ù‡πà‡∏≤‡∏¢‡∏ä‡∏≤‡∏¢
  </button>
</div>

<!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
<div class="glass rounded-3xl p-6 mb-8">
<div class="grid md:grid-cols-2 gap-6">

<div>
<label class="text-sm font-medium">‡∏ù‡πà‡∏≤‡∏¢</label>
<input id="groupDisplay" disabled
class="w-full mt-2 bg-gray-100 px-4 py-3 rounded-xl text-center font-semibold">
</div>

<div>
<label class="text-sm font-medium">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î</label>
<select id="contestant"
class="w-full mt-2 bg-gray-100 px-4 py-3 rounded-xl text-center font-semibold"></select>
</div>

</div>
</div>

<!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô -->
<div class="glass rounded-3xl p-8">

<div id="scoreTable" class="space-y-6"></div>

<!-- ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏° -->
<div class="mt-10">
<div class="flex justify-between mb-2 font-bold text-lg">
<span>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</span>
<span id="totalScore">0 / 100</span>
</div>

<div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
<div id="progressBar"
class="bg-gradient-to-r from-green-400 to-green-600 h-4 rounded-full transition-all duration-500"
style="width:0%"></div>
</div>

<div class="text-center mt-3 text-sm text-gray-500">
‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô <span id="percentDisplay">0%</span>
</div>
</div>

<!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å -->
<div class="text-center mt-8">
<button id="submitBtn"
onclick="submitScore()"
class="px-10 py-4 bg-green-400 text-white rounded-2xl hover:bg-green-500 font-semibold shadow-lg hover:scale-105 transition">
‚úî ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
</button>
</div>

</div>
</div>
</div>


<!-- üì± MOBILE BOTTOM NAV -->
<nav class="fixed bottom-0 left-0 w-full md:hidden
            glass border-t border-white/40
            flex justify-around items-center
            py-3 text-sm shadow-lg z-50">

<a href="home.html" class="flex flex-col items-center text-gray-600">
  <span class="text-lg">üè†</span>
  <span class="text-xs">Home</span>
</a>

<a href="dashboard.html" class="flex flex-col items-center text-gray-600">
  <span class="text-lg">üìä</span>
  <span class="text-xs">Dashboard</span>
</a>

<a href="ranking.html" class="flex flex-col items-center text-gray-600">
  <span class="text-lg">üèÜ</span>
  <span class="text-xs">Ranking</span>
</a>

<a href="vote.html" class="flex flex-col items-center text-purple-600 font-semibold">
  <span class="text-lg">üìù</span>
  <span class="text-xs">Vote</span>
</a>

</nav>


<footer class="hidden md:block mt-auto w-full text-center py-6 text-sm text-gray-500 bg-white/50 backdrop-blur-md">
  ¬© 2026 Back to School Event | Developed by Jakrayut Sangbunrueang
</footer>

<script>

document.getElementById("judgeNameTab").innerText = judgeName;

function logout(){
  localStorage.removeItem("judge");
  window.location.href="index.html";
}

let currentGroup="";
const femaleBtn = document.getElementById("femaleBtn");
const maleBtn = document.getElementById("maleBtn");

const criteria=[ 
{name:'‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢‡∏ï‡∏≤‡∏° Theme ‡∏á‡∏≤‡∏ô "Back to School"',max:20}, 
{name:"‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå",max:20}, 
{name:"‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏î‡∏î‡πÄ‡∏î‡πà‡∏ô ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î",max:15}, 
{name:"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à",max:15}, 
{name:"‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏≠‡∏Å",max:15}, 
{name:"‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à / ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô / ‡∏Å‡∏≤‡∏£‡πÇ‡∏û‡∏™‡∏ó‡πà‡∏≤ / ‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£",max:15} 
];

async function loadContestants(){
try{
const res = await fetch("https://script.google.com/macros/s/AKfycbw1hoYht8rbUixzNcXwtYVpQDhlKC3DU1YGtaBTUaKtiKpsmzFoFlW9ym7MmIyK-JcIcg/exec?action=getContestants");
const data = await res.json();

let html="";
data.forEach(number=>{
html+=`<option value="${number}">${number}</option>`;
});
document.getElementById("contestant").innerHTML=html;

}catch{
document.getElementById("contestant").innerHTML="<option>‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</option>";
}
}

function loadTable(){
let html="";
criteria.forEach((c,i)=>{
html+=`
<div class="bg-gray-50 p-5 rounded-2xl shadow-sm">
<div class="flex justify-between text-sm mb-3 font-medium">
<span>${i+1}. ${c.name}</span>
<span class="text-gray-500">‡πÄ‡∏ï‡πá‡∏° ${c.max}</span>
</div>
<input type="number"
min="0"
max="${c.max}"
oninput="validateInput(this)"
class="scoreInput w-full bg-white border px-4 py-3 rounded-xl text-center text-xl font-semibold focus:ring-2 focus:ring-purple-300">
</div>`;
});
document.getElementById("scoreTable").innerHTML=html;
}

function validateInput(input){
let max=parseInt(input.max);
let value=parseInt(input.value)||0;

if(value>max) value=max;
if(value<0) value=0;

input.value=value;
calculateTotal();
}

function calculateTotal(){
let total=0;
document.querySelectorAll(".scoreInput").forEach(i=>{
total+=parseInt(i.value)||0;
});

if(total>100) total=100;

document.getElementById("totalScore").innerText=total+" / 100";
document.getElementById("progressBar").style.width=total+"%";
document.getElementById("percentDisplay").innerText=total+"%";
}

function setGroup(group){
currentGroup=group;
document.getElementById("groupDisplay").value=
group==="female"?"‡∏ù‡πà‡∏≤‡∏¢‡∏´‡∏ç‡∏¥‡∏á":"‡∏ù‡πà‡∏≤‡∏¢‡∏ä‡∏≤‡∏¢";

femaleBtn.classList.remove("active-btn");
maleBtn.classList.remove("active-btn");

if(group==="female"){
femaleBtn.classList.add("active-btn");
}else{
maleBtn.classList.add("active-btn");
}
}

async function submitScore(){

if(currentGroup===""){
Swal.fire("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ù‡πà‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô","","warning");
return;
}

if(!document.getElementById("contestant").value){
Swal.fire("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ú‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î","","warning");
return;
}

let scores=[];
document.querySelectorAll(".scoreInput").forEach(i=>{
scores.push(parseInt(i.value)||0);
});

let total=scores.reduce((a,b)=>a+b,0);

if(total===0){
Swal.fire("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡πà‡∏≠‡∏ô","","warning");
return;
}

const btn=document.getElementById("submitBtn");
btn.disabled=true;
btn.innerText="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";

const payload={
group:currentGroup,
contestant:document.getElementById("contestant").value,
judge:judgeName,
total:total,
theme:scores[0],
creative:scores[1],
standout:scores[2],
talent:scores[3],
personality:scores[4],
confidence:scores[5]
};

try{

const response=await fetch("https://script.google.com/macros/s/AKfycbw1hoYht8rbUixzNcXwtYVpQDhlKC3DU1YGtaBTUaKtiKpsmzFoFlW9ym7MmIyK-JcIcg/exec",{
method:"POST",
body:JSON.stringify(payload)
});

const result=await response.text();

if(result==="DUPLICATE"){
Swal.fire("‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡πâ‡∏ß","‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß","error");
}else{
Swal.fire("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à","‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢","success");
document.querySelectorAll(".scoreInput").forEach(i=>i.value="");
calculateTotal();
}

}catch{
Swal.fire("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î","‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà","error");
}

btn.disabled=false;
btn.innerText="‚úî ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô";
}

loadContestants();
loadTable();

</script>

</body>
</html>
